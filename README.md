# Go-DDNS: ä¸€ä¸ªæ”¯æŒå¤šç”¨æˆ·çš„åŠ¨æ€åŸŸåè§£æå·¥å…· (V2.1.0)

![Go Version](https://img.shields.io/badge/Go-1.18+-blue.svg)
![License](https://img.shields.io/badge/license-MIT-green.svg)
![Platform](https://img.shields.io/badge/platform-linux%20%7C%20windows%20%7C%20macos-lightgrey.svg)

è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨ Go è¯­è¨€ç¼–å†™çš„ã€åŠŸèƒ½å¼ºå¤§çš„åŠ¨æ€åŸŸåè§£æï¼ˆDDNSï¼‰æœåŠ¡ï¼Œæ—¨åœ¨ä¸ºæ‚¨å’Œæ‚¨çš„ç”¨æˆ·æä¾›ä¸€ä¸ªç¨³å®šã€å®‰å…¨ä¸”æ˜“äºç®¡ç†çš„å¤šç”¨æˆ·DDNSè§£å†³æ–¹æ¡ˆã€‚

---

## âœ¨ V2.1.0 æ ¸å¿ƒåŠŸèƒ½

ç›¸è¾ƒäºä¹‹å‰çš„ç‰ˆæœ¬ï¼ŒV2.1.0å¸¦æ¥äº†æ¶æ„çº§å’ŒåŠŸèƒ½æ€§çš„å…¨é¢å‡çº§ï¼š

- **å¤šç”¨æˆ·æ”¯æŒ**: æœåŠ¡ç«¯å¯é€šè¿‡`users.json`æ–‡ä»¶è½»æ¾ç®¡ç†å¤šä¸ªç”¨æˆ·ï¼Œæ¯ä¸ªç”¨æˆ·æ‹¥æœ‰ç‹¬ç«‹çš„å¯†é’¥å’ŒåŸŸåé…ç½®ã€‚
- **è‡ªåŠ¨åŸŸåæ³¨å†Œ**: ç”¨æˆ·é¦–æ¬¡è¯·æ±‚è§£ææ–°åŸŸåæ—¶ï¼ŒæœåŠ¡ç«¯ä¼šè‡ªåŠ¨æ£€æŸ¥å†²çªå¹¶åœ¨é˜¿é‡Œäº‘åˆ›å»ºAè®°å½•ï¼Œæ— éœ€æ‰‹åŠ¨é¢„å…ˆé…ç½®ã€‚
- **åŸŸåé…é¢ç®¡ç†**: å¯ä¸ºæ¯ä¸ªç”¨æˆ·è®¾ç½®å¯æ‹¥æœ‰çš„åŸŸåæ•°é‡ä¸Šé™ï¼ˆé»˜è®¤ä¸º1ï¼‰ï¼Œæœ‰æ•ˆé˜²æ­¢èµ„æºæ»¥ç”¨ã€‚
- **å®¢æˆ·ç«¯CLIç®¡ç†**: å®¢æˆ·ç«¯å‡çº§ä¸ºåŠŸèƒ½å¼ºå¤§çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œæ”¯æŒæŸ¥çœ‹å·²ç”¨åŸŸåã€æ‰‹åŠ¨æ³¨é”€åŸŸåã€ä»¥åŠå®‰å…¨åœ°é‡ç½®åŠ å¯†å¯†é’¥ç­‰è‡ªåŠ©ç®¡ç†æ“ä½œã€‚
- **åº”ç”¨å±‚åŠ å¯†**: å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´çš„æ‰€æœ‰æ ¸å¿ƒé€šä¿¡éƒ½ä½¿ç”¨ç”¨æˆ·ç‹¬ç«‹çš„å¯†é’¥è¿›è¡ŒAES-GCMåŠ å¯†ï¼Œç¡®ä¿æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­çš„æœºå¯†æ€§ã€‚
- **æ¨¡å—åŒ–æ¶æ„**: æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä»£ç å‡ç»è¿‡é‡æ„ï¼Œæƒè´£åˆ†æ˜ï¼Œæ›´æ˜“äºç»´æŠ¤å’ŒäºŒæ¬¡å¼€å‘ã€‚
- **å®‰å…¨å¢å¼º**: å¼•å…¥äº†é€Ÿç‡é™åˆ¶ã€è¯·æ±‚å¤§å°é™åˆ¶å’Œä¸¥æ ¼çš„è¾“å…¥éªŒè¯ï¼Œæå‡äº†æœåŠ¡çš„å¥å£®æ€§ã€‚

## ğŸ—ï¸ æ¶æ„

æœ¬å·¥å…·ç”±ä¸€ä¸ªæœåŠ¡ç«¯ç¨‹åºå’Œä¸€ä¸ªå®¢æˆ·ç«¯ç¨‹åºç»„æˆï¼š

- **æœåŠ¡ç«¯ (`ddns-server`)**: éƒ¨ç½²åœ¨å…·æœ‰å›ºå®šå…¬ç½‘IPçš„æœåŠ¡å™¨ä¸Šï¼ˆå¦‚é˜¿é‡Œäº‘ECSï¼‰ã€‚å®ƒç°åœ¨æ˜¯ä¸€ä¸ªå¤šç”¨æˆ·æœåŠ¡ä¸­å¿ƒï¼Œè´Ÿè´£ç”¨æˆ·è®¤è¯ã€åŸŸåæ ¡éªŒä¸æ³¨å†Œã€ä»¥åŠè°ƒç”¨é˜¿é‡Œäº‘APIæ‰§è¡ŒDNSæ›´æ–°ã€‚
- **å®¢æˆ·ç«¯ (`ddns-client`)**: éƒ¨ç½²åœ¨ä»»æ„éœ€è¦DDNSæœåŠ¡çš„æœºå™¨ä¸Šï¼ˆå¦‚å®¶åº­æœåŠ¡å™¨ã€åŠå…¬å®¤ç”µè„‘ï¼‰ã€‚å®ƒç°åœ¨æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œä¸ä»…èƒ½è‡ªåŠ¨æ›´æ–°IPï¼Œè¿˜èƒ½è®©ç”¨æˆ·ç®¡ç†è‡ªå·±çš„åŸŸåè®°å½•å’Œå¯†é’¥ã€‚

## âš™ï¸ ä½¿ç”¨æ–¹æ³• (é’ˆå¯¹æ™®é€šç”¨æˆ·)

å¦‚æœæ‚¨ä¸æƒ³è‡ªå·±ç¼–è¯‘ï¼Œæœ€ç®€å•çš„æ–¹å¼æ˜¯ä»æœ¬ä»“åº“çš„ **Releases** é¡µé¢ä¸‹è½½å·²ç¼–è¯‘å¥½çš„å¯æ‰§è¡Œç¨‹åºã€‚

### ç¬¬1æ­¥ï¼šä¸‹è½½ç¨‹åº

è®¿é—®æœ¬é¡¹ç›®çš„ [Releases é¡µé¢](https://github.com/keepsea/goddns/releases) (è¯·å°† `keepsea/goddns` æ›¿æ¢ä¸ºæ‚¨çš„å®é™…ä»“åº“åœ°å€)ï¼Œæ ¹æ®æ‚¨çš„æ“ä½œç³»ç»Ÿä¸‹è½½å¯¹åº”çš„æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ç¨‹åºã€‚

### ç¬¬2æ­¥ï¼šé…ç½®

ä¸‹è½½åï¼Œæ‚¨éœ€è¦ä¸ºæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯åˆ†åˆ«åˆ›å»ºé…ç½®æ–‡ä»¶ã€‚

**æœåŠ¡ç«¯é…ç½® (æ”¾ç½®åœ¨ `ddns-server-linux` åŒä¸€ç›®å½•):**

1.  **`server.ini`**:
    ```ini
    [server]
    # æœåŠ¡ç›‘å¬çš„ç«¯å£å·
    listen_port = 9876
    ```

2.  **`users.json`**:
    ```json
    {
      "users": [
        {
          "username": "okrj",
          "secret_token": "a-very-strong-token-for-okrj",
          "encryption_key": "a-32-byte-long-unique-encryption-key-!",
          "domain_limit": 2,
          "records": []
        },
        {
          "username": "friend1",
          "secret_token": "another-secret-token-for-friend",
          "encryption_key": "another-32-byte-unique-key-for-friend-!",
          "domain_limit": 1,
          "records": []
        }
      ]
    }
    ```

**å®¢æˆ·ç«¯ `config.ini` (æ”¾ç½®åœ¨å®¢æˆ·ç«¯ç¨‹åºåŒä¸€ç›®å½•):**
```ini
[client]
# DDNSæœåŠ¡ç«¯çš„å®Œæ•´URLåœ°å€
server_url = http://YOUR_ECS_PUBLIC_IP:9876

# æ‚¨åœ¨è¿™ä¸ªç³»ç»Ÿä¸­çš„ç”¨æˆ·å (å¿…é¡»ä¸æœåŠ¡ç«¯ users.json ä¸­çš„é…ç½®åŒ¹é…)
username = okrj
# æ‚¨çš„è®¤è¯å¯†é’¥ (secret_token)ï¼Œç”¨äºå‘æœåŠ¡ç«¯è¯æ˜æ‚¨çš„æƒé™
secret_token = a-very-strong-token-for-okrj
# æ‚¨çš„ç‹¬ç«‹åŠ å¯†å¯†é’¥ (encryption_key)ï¼Œç”¨äºåŠ å¯†æ‰€æœ‰é€šä¿¡å†…å®¹
encryption_key = a-32-byte-long-unique-encryption-key-!

# --- ä»¥ä¸‹é…ç½®ä»…åœ¨è¿è¡ŒIPæ›´æ–°æ—¶éœ€è¦ ---
# æ‚¨å¸Œæœ›æ³¨å†Œå’Œæ›´æ–°çš„ä¸»åŸŸå
domain_name = anxinred.com
# æ‚¨å¸Œæœ›æ³¨å†Œå’Œæ›´æ–°çš„ä¸»æœºè®°å½• (ä¾‹å¦‚ 'www', 'nas')
rr = homehost
# æ£€æŸ¥å…¬ç½‘IPçš„æ—¶é—´é—´éš”ï¼ˆç§’ï¼‰
check_interval_seconds = 300
```

### ç¬¬3æ­¥ï¼šè¿è¡Œç¨‹åº

#### æœåŠ¡ç«¯ (åœ¨é˜¿é‡Œäº‘ECSä¸Š)
1.  **è®¾ç½®é˜¿é‡Œäº‘å‡­è¯**:
    ```bash
    export ALIBABA_CLOUD_ACCESS_KEY_ID="YOUR_ACCESS_KEY_ID"
    export ALIBABA_CLOUD_ACCESS_KEY_SECRET="YOUR_ACCESS_KEY_SECRET"
    ```

2.  **é…ç½®å®‰å…¨ç»„**ï¼šç™»å½•é˜¿é‡Œäº‘æ§åˆ¶å°ï¼Œç¡®ä¿ECSçš„å®‰å…¨ç»„å·²ç»æ”¾è¡Œäº†æ‚¨åœ¨`server.ini`ä¸­è®¾ç½®çš„`listen_port`ã€‚

3.  **å¯åŠ¨æœåŠ¡**:
    ```bash
    chmod +x ./ddns-server-linux
    nohup ./ddns-server-linux > ddns.log 2>&1 &
    ```

#### å®¢æˆ·ç«¯ (åœ¨å®¶åº­æœåŠ¡å™¨/Windows/macOSä¸Š)
å®¢æˆ·ç«¯ç°åœ¨æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…· (CLI)ã€‚

* **å¯åŠ¨åå°IPæ›´æ–° (é»˜è®¤æ“ä½œ)**:
    ```bash
    # åœ¨Linux/macOSä¸Š
    nohup ./ddns-client-linux -update > ddns-client.log 2>&1 &
    # åœ¨Windowsä¸Šç›´æ¥è¿è¡Œ
    .\ddns-client.exe -update
    ```
* **æŸ¥çœ‹å·²æ³¨å†Œçš„åŸŸå**:
    ```bash
    ./ddns-client-linux -list
    ```
* **æ³¨é”€ä¸€ä¸ªåŸŸå**:
    ```bash
    ./ddns-client-linux -remove home.example.com
    ```
* **æŸ¥çœ‹åŠ å¯†å¯†é’¥**:
    ```bash
    ./ddns-client-linux -view-key
    ```
* **é‡ç½®åŠ å¯†å¯†é’¥**:
    ```bash
    ./ddns-client-linux -reset-key
    ```
* **æŸ¥çœ‹å¸®åŠ©**:
    ```bash
    ./ddns-client-linux -help
    ```

## ğŸ‘¨â€ğŸ’» ä»æºç ç¼–è¯‘ (é’ˆå¯¹å¼€å‘è€…)

1.  **å…‹éš†ä»“åº“**:
    ```bash
    git clone [https://github.com/keepsea/goddns.git](https://github.com/keepsea/goddns.git)
    cd goddns
    ```

2.  **ç¼–è¯‘**:
    æœ¬é¡¹ç›®å·²åŒ…å«æ‰€æœ‰ä¾èµ– (`vendor`ç›®å½•)ï¼Œæ‚¨æ— éœ€ä¸‹è½½ä»»ä½•ä¸œè¥¿ï¼Œå¯ä»¥ç›´æ¥ç¼–è¯‘ã€‚ä¾‹å¦‚ï¼Œä¸ºLinuxç¼–è¯‘æœåŠ¡ç«¯ï¼š
    ```bash
    cd ddns-server
    go build -mod=vendor -o ddns-server-linux .
    ```

## âš ï¸ æ³¨æ„äº‹é¡¹
- è¯·åŠ¡å¿…ä¿è¯æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„ `secret_token`, `username`, `encryption_key` å®Œå…¨åŒ¹é…ã€‚
- è¯·å¦¥å–„ä¿ç®¡æ‚¨çš„é˜¿é‡Œäº‘AccessKeyå’Œç”¨æˆ·å¯†é’¥ï¼Œä¸è¦æ³„éœ²ã€‚
- å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­é…åˆNginxç­‰åå‘ä»£ç†ï¼Œä¸ºæœåŠ¡ç«¯å¯ç”¨HTTPSåŠ å¯†é€šä¿¡ã€‚
